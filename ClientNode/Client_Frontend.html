
<!DOCTYPE html>
<html>
<head>
    <title>Seed URL Submission</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

</head>
<body>

<div class='bold-line'></div>
<div class='parent-container'>
<div class='container1'>
  <div class='window'>
    <div class='overlay'></div>
    <div class='content1'>
      <div class='welcome'>Submit Seed URL</div>
      <div class='input-fields'>
      <input class='input-line full-width' type="text" id="url" placeholder="Seed URL" required>
    <input class='input-line full-width' type="number" id="depth" placeholder="Crawl Depth" required></div>
    <div><button class="ghost-round full-width" onclick="sendSeedToSQS()">Send</button></div>
    <p id="seedResponse"></p></div>

    <div class='content2'>
    <div class='welcome'>Submit Search Query</div>
        
            <div class="search-box">
                <button class="btn-search" onclick="submitSearchAndDisplayResults()"><i class="fas fa-search" ></i></button>
                <input class='input-search' type="text" id="keywords" placeholder="Search Keywords" required></div>
            
    <p id="searchResponse"></p>
    <!-- <div class="card">
        <div class="card-header">Search Results</div>
        <div class="card-body">
          <div id="resultsContainer" class="results-container"></div>
        </div>
      </div>
    </div> -->
    
    </div>
    </div>
</div>
     
    
<script>


async function sendSeedToSQS() {
    const url = document.getElementById('url').value;
    const depth = document.getElementById('depth').value;
    const resElem = document.getElementById('seedResponse');

    const payload = { url, depth };
    console.log('[Client] Preparing to send payload:', payload);

    try {
        const response = await fetch('http://54.88.141.236:5000/send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload),
            mode: 'cors',
            cache: 'no-cache'
        });

        const raw = await response.text();
        console.log('[Client] Raw response text:', raw);

        try {
            const data = JSON.parse(raw);
            resElem.innerText = data.message || 'Success';
      } catch (parseError) {
            console.error('[Client] JSON parse error:', parseError);
            resElem.innerText = 'Invalid JSON from server: ' + parseError + '\n' + raw;
        }
    } catch (err) {
        console.error('[Client] Fetch/network error:', err);
        resElem.innerText = 'Network or CORS error: ' + err;
    }
}


// async function submitSearch() {
//     const keywords = document.getElementById('keywords').value;
//     const feedback = document.getElementById('searchResponse');
//     feedback.textContent = 'Searching...';

//     try {
//       const resp = await fetch('http://<EC2_PUBLIC_DNS>:5000/send-search', {
//         method: 'POST', headers: {'Content-Type': 'application/json'},
//         body: JSON.stringify({keywords}), mode: 'cors'
//       });
//       const { request_id } = await resp.json();
//       displayResults(request_id);
//       feedback.textContent = '';
//     } catch (err) {
//       feedback.textContent = 'Error submitting search: ' + err;
//     }
//   }

//   // Fetch and display results as cards
//   async function displayResults(requestId) {
//     const container = document.getElementById('resultsContainer');
//     container.innerHTML = '<p class="feedback">Loading results...</p>';
//     try {
//       const resp = await fetch('http://<EC2_PUBLIC_DNS>:5000/get-search-results', {mode:'cors'});
//       const { results, message } = await resp.json();
//       if (!results) {
//         container.innerHTML = '<p class="feedback">${message}</p>;'
//         return;
//       }

//       container.innerHTML = '';
//       results.forEach(item => {
//         const card = document.createElement('div');
//         card.className = 'result-card';
//         card.innerHTML = `
//           <h3>${item.title}</h3>
//           <p><strong>Keywords:</strong> ${item.keywords}</p>
//           <p>${item.description}</p>
//           <p><strong>S3:</strong> <a href="https://s3.amazonaws.com/${item.s3_bucket}/${item.s3_key}" target="_blank">View Source</a></p>
//           <p><strong>URL:</strong> <a href="${item.url}" target="_blank">${item.url}</a></p>
//         `;
//         container.appendChild(card);
//       });
//     } catch (err) {
//       container.innerHTML = '<p class="feedback">Error loading results: ${err}</p>;'
//     }
//   }


async function submitSearchAndDisplayResults() {
    const keywords = document.getElementById('keywords').value;
    const resElem = document.getElementById('searchResponse');

    console.log('[Client] Preparing to send search keyword:', keywords);

    try {
        // Send 
        const keywords = document.getElementById('keywords').value;
        const resElem = document.getElementById('searchResponse');
        const payload = { keywords };

        try {
            const response = await fetch('http://44.204.18.153:5000/send-search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
                mode: 'cors',
                cache: 'no-cache'
            });
            const data = await response.json();
            resElem.innerText = data.message;
        } catch (err) {
            resElem.innerText = 'Error: ' + err;
        }

        // fetch 
        const resultsResponse = await fetch('http://44.204.18.153:5000/get-search-results', {
            method: 'GET',
            mode: 'cors',
            cache: 'no-cache'
        });

        const resultsData = await resultsResponse.json();
        if (resultsData.results ) {
            // Clear previous results
            resElem.innerHTML = '';

            // Loop through each result and display the details
            resultsData.results.forEach(result => {
                const resultDiv = document.createElement('div');
                resultDiv.classList.add('result-item');

                // Add title
                const titleElem = document.createElement('h3');
                titleElem.textContent = `Title: ${result.title}`;
                resultDiv.appendChild(titleElem);

                // Add URL
                const urlElem = document.createElement('p');
                const urlLink = document.createElement('a');
                urlLink.href = result.url;
                urlLink.textContent = `URL: ${result.url}`;
                urlLink.target = '_blank'; // Open in a new tab
                urlElem.appendChild(urlLink);
                resultDiv.appendChild(urlElem);

                // Add keywords
                const keywordsElem = document.createElement('p');
                keywordsElem.textContent = `Keywords: ${result.keywords}`;
                resultDiv.appendChild(keywordsElem);

                // Add description
                const descriptionElem = document.createElement('p');
                descriptionElem.textContent = `Description: ${result.description}`;
                resultDiv.appendChild(descriptionElem);

                // Append the result to the response element
                resElem.appendChild(resultDiv);
            });
        } else {
            resElem.innerText = resultsData.message || 'No results found.';
        }
    } catch (err) {
        console.error('[Client] Fetch/network error:', err);
        resElem.innerText = 'Network or CORS error: ' + err;
    }
}

document.getElementById('keywords').addEventListener('keydown', function (event) {
    if (event.key === 'Enter') {
        event.preventDefault(); 
        document.querySelector('.btn-search').click(); 
    }
});




</script>



    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1370.0.min.js"></script>
</body>
</html>

